<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç§äººè§†é¢‘é€šè¯</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f4f4f9; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .controls { margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; }
        input { padding: 8px; width: 200px; margin-right: 10px; }
        button { padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .video-grid { display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
        video { width: 45%; background-color: #000; border-radius: 8px; border: 2px solid #ccc; }
        #my-id-display { font-weight: bold; color: #d32f2f; user-select: all; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“¡ WebRTC è§†é¢‘é€šè¯ (ç§å¯†è”ç³»)</h2>

    <div class="controls">
        <p>ä½ çš„ä¸“å± ID: <span id="my-id-display">æ­£åœ¨è·å–...</span></p>
        <p style="font-size: 0.9em; color: #666;">ï¼ˆå¤åˆ¶ä¸Šé¢çš„ ID å‘ç»™å¯¹æ–¹ï¼Œæˆ–è€…è¾“å…¥å¯¹æ–¹çš„ ID å‘¼å«ï¼‰</p>
        <div>
            <input type="text" id="remote-id-input" placeholder="è¾“å…¥å¯¹æ–¹çš„ ID">
            <button id="call-btn">æ‹¨æ‰“è§†é¢‘</button>
        </div>
    </div>

    <div class="video-grid">
        <video id="local-video" autoplay playsinline muted></video>
        <video id="remote-video" autoplay playsinline></video>
    </div>
</div>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script>
    const localVideo = document.getElementById('local-video');
    const remoteVideo = document.getElementById('remote-video');
    const myIdDisplay = document.getElementById('my-id-display');
    const remoteIdInput = document.getElementById('remote-id-input');
    const callBtn = document.getElementById('call-btn');

    let localStream;

    // æ›¿æ¢åŸæœ¬çš„ Peer åˆå§‹åŒ–ä»£ç 
    const peer = new Peer({
        config: {
            'iceServers': [
                { url: 'stun:stun.qq.com:3478' },           // è…¾è®¯ STUN
                { url: 'stun:stun.miwifi.com:3478' },       // å°ç±³ STUN
                { url: 'stun:global.stun.twilio.com:3478' } // Twilio å…¨çƒå…¬å…± STUN
            ]
        }
    });

    peer.on('open', (id) => {
        myIdDisplay.innerText = id;
    });

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then((stream) => {
            localStream = stream;
            localVideo.srcObject = stream;

            peer.on('call', (call) => {
                call.answer(localStream);
                call.on('stream', (remoteStream) => {
                    remoteVideo.srcObject = remoteStream;
                });
            });
        })
        .catch((err) => {
            console.error('è·å–æ‘„åƒå¤´å¤±è´¥:', err);
            alert('æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·ç¡®ä¿åœ¨æµè§ˆå™¨ä¸­æˆäºˆäº†æƒé™ã€‚');
        });

    callBtn.addEventListener('click', () => {
        const remoteId = remoteIdInput.value.trim();
        if (!remoteId) return alert('è¯·å…ˆè¾“å…¥å¯¹æ–¹çš„ IDï¼');

        const call = peer.call(remoteId, localStream);
        call.on('stream', (remoteStream) => {
            remoteVideo.srcObject = remoteStream;
        });
    });
</script>

</body>
</html>

